jQuery.extend({roundabout_shape:{def:"lazySusan",lazySusan:function(t,e,a){return{x:Math.sin(t+e),y:Math.sin(t+3*Math.PI/2+e)/8*a,z:(Math.cos(t+e)+1)/2,scale:Math.sin(t+Math.PI/2+e)/2+.5}}}}),jQuery.fn.roundabout=function(){var t="object"!=typeof arguments[0]?{}:arguments[0];if(t={bearing:"undefined"==typeof t.bearing?0:jQuery.roundabout_toFloat(t.bearing%360),tilt:"undefined"==typeof t.tilt?0:jQuery.roundabout_toFloat(t.tilt),minZ:"undefined"==typeof t.minZ?100:parseInt(t.minZ,10),maxZ:"undefined"==typeof t.maxZ?400:parseInt(t.maxZ,10),minOpacity:"undefined"==typeof t.minOpacity?.4:jQuery.roundabout_toFloat(t.minOpacity),maxOpacity:"undefined"==typeof t.maxOpacity?1:jQuery.roundabout_toFloat(t.maxOpacity),minScale:"undefined"==typeof t.minScale?.4:jQuery.roundabout_toFloat(t.minScale),maxScale:"undefined"==typeof t.maxScale?1:jQuery.roundabout_toFloat(t.maxScale),duration:"undefined"==typeof t.duration?600:parseInt(t.duration,10),btnNext:t.btnNext||null,btnPrev:t.btnPrev||null,easing:t.easing||"swing",clickToFocus:t.clickToFocus!==!1,focusBearing:"undefined"==typeof t.focusBearing?0:jQuery.roundabout_toFloat(t.focusBearing%360),shape:t.shape||"lazySusan",debug:t.debug||!1,childSelector:t.childSelector||"li",startingChild:"undefined"==typeof t.startingChild?null:parseInt(t.startingChild,10),reflect:"undefined"==typeof t.reflect||t.reflect===!1?!1:!0},this.each(function(){var e=jQuery(this),a=jQuery.roundabout_toFloat(360/e.children(t.childSelector).length),n=null===t.startingChild?t.bearing:t.startingChild*a;e.addClass("roundabout-holder").css("padding",0).css("position","relative").css("z-index",t.minZ),e.data("roundabout",{bearing:n,tilt:t.tilt,minZ:t.minZ,maxZ:t.maxZ,minOpacity:t.minOpacity,maxOpacity:t.maxOpacity,minScale:t.minScale,maxScale:t.maxScale,duration:t.duration,easing:t.easing,clickToFocus:t.clickToFocus,focusBearing:t.focusBearing,animating:0,childInFocus:-1,shape:t.shape,period:a,debug:t.debug,childSelector:t.childSelector,reflect:t.reflect}),t.clickToFocus===!0&&e.children(t.childSelector).each(function(n){jQuery(this).click(function(u){var o=t.reflect===!0?360-a*n:a*n;return o=jQuery.roundabout_toFloat(o),jQuery.roundabout_isInFocus(e,o)?void 0:(u.preventDefault(),0===e.data("roundabout").animating&&e.roundabout_animateAngleToFocus(o),!1)})}),t.btnNext&&jQuery(t.btnNext).bind("click.roundabout",function(t){return t.preventDefault(),0===e.data("roundabout").animating&&e.roundabout_animateToNextChild(),!1}),t.btnPrev&&jQuery(t.btnPrev).bind("click.roundabout",function(t){return t.preventDefault(),0===e.data("roundabout").animating&&e.roundabout_animateToPreviousChild(),!1})}),this.roundabout_startChildren(),"function"==typeof arguments[1]){var e=arguments[1],a=this;setTimeout(function(){e(a)},0)}return this},jQuery.fn.roundabout_startChildren=function(){return this.each(function(){var t=jQuery(this),e=t.data("roundabout"),a=t.children(e.childSelector);a.each(function(t){var a=e.reflect===!0?360-e.period*t:e.period*t;jQuery(this).addClass("roundabout-moveable-item").css("position","absolute"),jQuery(this).data("roundabout",{startWidth:jQuery(this).width(),startHeight:jQuery(this).height(),startFontSize:parseInt(jQuery(this).css("font-size"),10),degrees:a})}),t.roundabout_updateChildPositions()}),this},jQuery.fn.roundabout_setTilt=function(t){if(this.each(function(){jQuery(this).data("roundabout").tilt=t,jQuery(this).roundabout_updateChildPositions()}),"function"==typeof arguments[1]){var e=arguments[1],a=this;setTimeout(function(){e(a)},0)}return this},jQuery.fn.roundabout_setBearing=function(t){if(this.each(function(){jQuery(this).data("roundabout").bearing=jQuery.roundabout_toFloat(t%360,2),jQuery(this).roundabout_updateChildPositions()}),"function"==typeof arguments[1]){var e=arguments[1],a=this;setTimeout(function(){e(a)},0)}return this},jQuery.fn.roundabout_adjustBearing=function(t){if(t=jQuery.roundabout_toFloat(t),0!==t&&this.each(function(){jQuery(this).data("roundabout").bearing=jQuery.roundabout_getBearing(jQuery(this))+t,jQuery(this).roundabout_updateChildPositions()}),"function"==typeof arguments[1]){var e=arguments[1],a=this;setTimeout(function(){e(a)},0)}return this},jQuery.fn.roundabout_adjustTilt=function(t){if(t=jQuery.roundabout_toFloat(t),0!==t&&this.each(function(){jQuery(this).data("roundabout").tilt=jQuery.roundabout_toFloat(jQuery(this).roundabout_get("tilt")+t),jQuery(this).roundabout_updateChildPositions()}),"function"==typeof arguments[1]){var e=arguments[1],a=this;setTimeout(function(){e(a)},0)}return this},jQuery.fn.roundabout_animateToBearing=function(t){t=jQuery.roundabout_toFloat(t);var e=new Date,a="undefined"==typeof arguments[1]?null:arguments[1],n="undefined"==typeof arguments[2]?null:arguments[2],u="object"!=typeof arguments[3]?null:arguments[3];return this.each(function(){var o,r,i,s=jQuery(this),d=s.data("roundabout"),c=null===a?d.duration:a,h=null!==n?n:d.easing||"swing";null===u&&(u={timerStart:e,start:jQuery.roundabout_getBearing(s),totalTime:c}),o=e-u.timerStart,c>o?(d.animating=1,"string"==typeof jQuery.easing.def?(r=jQuery.easing[h]||jQuery.easing[jQuery.easing.def],i=r(null,o,u.start,t-u.start,u.totalTime)):i=jQuery.easing[h](o/u.totalTime,o,u.start,t-u.start,u.totalTime),s.roundabout_setBearing(i,function(){s.roundabout_animateToBearing(t,c,h,u)})):(t=0>t?t+360:t%360,d.animating=0,s.roundabout_setBearing(t))}),this},jQuery.fn.roundabout_animateToDelta=function(t){var e=arguments[1],a=arguments[2];return this.each(function(){t=jQuery.roundabout_getBearing(jQuery(this))+jQuery.roundabout_toFloat(t),jQuery(this).roundabout_animateToBearing(t,e,a)}),this},jQuery.fn.roundabout_animateToChild=function(t){var e=arguments[1],a=arguments[2];return this.each(function(){var n=jQuery(this),u=n.data("roundabout");if(u.childInFocus!==t&&0===u.animating){var o=jQuery(n.children(u.childSelector)[t]);n.roundabout_animateAngleToFocus(o.data("roundabout").degrees,e,a)}}),this},jQuery.fn.roundabout_animateToNearbyChild=function(t,e){var a=t[0],n=t[1];return this.each(function(){var t,u=jQuery(this).data("roundabout"),o=jQuery.roundabout_toFloat(360-jQuery.roundabout_getBearing(jQuery(this))),r=u.period,i=0,s=u.reflect,d=jQuery(this).children(u.childSelector).length;if(o=s===!0?o%360:o,0===u.animating)if(s===!1&&"next"===e||s===!0&&"next"!==e)for(o=0===o?360:o;d>i;){if(t={lower:jQuery.roundabout_toFloat(r*i),upper:jQuery.roundabout_toFloat(r*(i+1))},t.upper=i==d-1?360:t.upper,o<=t.upper&&o>t.lower){jQuery(this).roundabout_animateToDelta(o-t.lower,a,n);break}i++}else for(;;){if(t={lower:jQuery.roundabout_toFloat(r*i),upper:jQuery.roundabout_toFloat(r*(i+1))},t.upper=i==d-1?360:t.upper,o>=t.lower&&o<t.upper){jQuery(this).roundabout_animateToDelta(o-t.upper,a,n);break}i++}}),this},jQuery.fn.roundabout_animateToNextChild=function(){return this.roundabout_animateToNearbyChild(arguments,"next")},jQuery.fn.roundabout_animateToPreviousChild=function(){return this.roundabout_animateToNearbyChild(arguments,"previous")},jQuery.fn.roundabout_animateAngleToFocus=function(t){var e=arguments[1],a=arguments[2];return this.each(function(){var n=jQuery.roundabout_getBearing(jQuery(this))-t;n=Math.abs(360-n)<Math.abs(0-n)?360-n:0-n,n=n>180?-(360-n):n,0!==n&&jQuery(this).roundabout_animateToDelta(n,e,a)}),this},jQuery.fn.roundabout_updateChildPositions=function(){return this.each(function(){var t=jQuery(this),e=t.data("roundabout"),a=-1,n={bearing:jQuery.roundabout_getBearing(t),tilt:e.tilt,stage:{width:Math.floor(.9*t.width()),height:Math.floor(.9*t.height())},animating:e.animating,inFocus:e.childInFocus,focusBearingRad:jQuery.roundabout_degToRad(e.focusBearing),shape:jQuery.roundabout_shape[e.shape]||jQuery.roundabout_shape[jQuery.roundabout_shape.def]};n.midStage={width:n.stage.width/2,height:n.stage.height/2},n.nudge={width:n.midStage.width+.05*n.stage.width,height:n.midStage.height+.05*n.stage.height},n.zValues={min:e.minZ,max:e.maxZ,diff:e.maxZ-e.minZ},n.opacity={min:e.minOpacity,max:e.maxOpacity,diff:e.maxOpacity-e.minOpacity},n.scale={min:e.minScale,max:e.maxScale,diff:e.maxScale-e.minScale},t.children(e.childSelector).each(function(e){jQuery.roundabout_updateChildPosition(jQuery(this),t,n,e)&&0===n.animating?(a=e,jQuery(this).addClass("roundabout-in-focus")):jQuery(this).removeClass("roundabout-in-focus")}),a!==n.inFocus&&(jQuery.roundabout_triggerEvent(t,n.inFocus,"blur"),-1!==a&&jQuery.roundabout_triggerEvent(t,a,"focus"),e.childInFocus=a)}),this},jQuery.roundabout_getBearing=function(t){return jQuery.roundabout_toFloat(t.data("roundabout").bearing)%360},jQuery.roundabout_degToRad=function(t){return t%360*Math.PI/180},jQuery.roundabout_isInFocus=function(t,e){return jQuery.roundabout_getBearing(t)%360===e%360},jQuery.roundabout_triggerEvent=function(t,e,a){return 0>e?this:jQuery(t.children(t.data("roundabout").childSelector)[e]).trigger(a)},jQuery.roundabout_toFloat=function(t){return t=Math.round(1e3*parseFloat(t))/1e3,parseFloat(t.toFixed(2))},jQuery.roundabout_updateChildPosition=function(t,e,a,n){for(var u=jQuery(t),o=u.data("roundabout"),r=[],i=jQuery.roundabout_degToRad(360-u.data("roundabout").degrees+a.bearing);0>i;)i+=2*Math.PI;for(;i>2*Math.PI;)i-=2*Math.PI;var s=a.shape(i,a.focusBearingRad,a.tilt);return s.scale=s.scale>1?1:s.scale,s.adjustedScale=(a.scale.min+a.scale.diff*s.scale).toFixed(4),s.width=(s.adjustedScale*o.startWidth).toFixed(4),s.height=(s.adjustedScale*o.startHeight).toFixed(4),u.css("left",(s.x*a.midStage.width+a.nudge.width-s.width/2).toFixed(1)+"px").css("top",(s.y*a.midStage.height+a.nudge.height-s.height/2).toFixed(1)+"px").css("width",s.width+"px").css("height",s.height+"px").css("opacity",(a.opacity.min+a.opacity.diff*s.scale).toFixed(2)).css("z-index",Math.round(a.zValues.min+a.zValues.diff*s.z)).css("font-size",(s.adjustedScale*o.startFontSize).toFixed(2)+"px").attr("current-scale",s.adjustedScale),e.data("roundabout").debug===!0&&(r.push('<div style="font-weight: normal; font-size: 10px; padding: 2px; width: '+u.css("width")+'; background-color: #ffc;">'),r.push('<strong style="font-size: 12px; white-space: nowrap;">Child '+n+"</strong><br />"),r.push("<strong>left:</strong> "+u.css("left")+"<br /><strong>top:</strong> "+u.css("top")+"<br />"),r.push("<strong>width:</strong> "+u.css("width")+"<br /><strong>opacity:</strong> "+u.css("opacity")+"<br />"),r.push("<strong>z-index:</strong> "+u.css("z-index")+"<br /><strong>font-size:</strong> "+u.css("font-size")+"<br />"),r.push("<strong>scale:</strong> "+u.attr("current-scale")),r.push("</div>"),u.html(r.join(""))),jQuery.roundabout_isInFocus(e,u.data("roundabout").degrees)};